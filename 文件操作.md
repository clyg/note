## C / C++中的文件操作
---
### 1. 需要包含的头文件
```c
#include<stdio.h>
```

### 2. 二进制文件与文本文件
- 二进制文件与文本文件的差异是逻辑上的差距, 并不是物理上的差距
- 二进制文件读取比特后按照不定长的进行读取
- 文本文件读取比特后按照一个自己一个字节进行读取

### 3. 文件操作常用函数
#### 1. fopen()用于打开一个文件
- 如果文件打开失败, 函数将返回NULL
```c
FILE *fopen(const char *filenae, const char *mode);
```
- **filename表示文件名**
- **mode表示文件打开的方式**

|方式|含义|说明|
|-|-|-|
|r|只读|文件必须存在|
|w|只写|如果文件存在, 清楚文件内容, 如果不存在, 则创建文件|
|a|追加只写|如果文件存在, 打开文件, 如果文件不存在, 创建文件|
|r+|读写|文件必须存在, 在只读的基础上增加了写的功能|
|w+|读写|在只写的方式上增加读的功能|
|a+|读写|在追加只写的方式上增加可读的功能|
#### 2. 文本文件的读写
##### 1. fprintf()用于向文件中写入文本
```c
int fprintf(FILE *fp, const char *format, ...);
```
使用方法与printf相同, 返回值不需要关心
##### 2. fgets()用于从文本文件中读取一行文本
```c
char *fgets(char *buf, int size, FILE *fp)
```
- **buf是一个字符串, 用于保存读到的数据**
- **size是读到数据的长度**
- **fp是文件指针**
- 如果文件中要读取的一行内容长度小于size, fgets函数就读取一行, 如果这一行内容大于等于size, fgets函数就读取size-1字节的内容
- fgets函数如果成功, 就返回buf, 如果读取错误或者文件结束, 返回NULL, 可以认为是文件读取结束
#### 3. 二进制文件的读写
##### 1. fwrite()用于向文件中写入数据块
```c
size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream);
```
- **ptr表示内存区块指针, 存放了要写入数据的地址**
- **size固定填写1**
- **nmemb表示打算写入数据的字节数**
- **fp表示文件指针**
- 返回值是本次成功写入数据的字节数
##### 2. fread()用于从文件中读取数据
```c
size_t fread(void *ptr, size_t size, size_t nmemb, FILE *fp);
```
- **ptr用于存放从文件中读取数据的变量地址**
- **size固定填写1**
- **nmemb表示打算读取的字节数**
- **fp表示文件指针**
- 函数读取成功时返回读取到的字节数, 读取错误或者文件已经读取完毕则返回NULL
#### 4. fclose用于关闭文件
```c
int fclose(FILE *fp);
```
- **fp为文件指针**
- 打开文件后一定要调用此函数来讲资源释放,佛祖而可能造成内存泄露
### 4.文件定位
- 文件内部都有一个位置指针, 用来指向文件当前读写的位置, 如果打开方式是r或者w, 文件指针指向文件的第一个字节, 而以a方式打开则会指向最后一个字节。
- 每当文件在进行读写的时候文件指针都会自动向前, 向后移动
- 文件位置指针和C语言中的指针不是一回事, 文件定位指针仅仅是一个标记而已
#### 1. ftell()用来返回当前文件位置指针的值
```c
long ftell(FILE *fp);
```
#### 2. rewind()用来将位置指针移动到文件开头
```c
void rewind(FILE *fp);
```
#### 3. fseek()用来将位置指针移动到任意位置
```c
int fseek(FILE *fp, long offset, int origin);
```
- **fp为文件指针**
- **offset为偏移量, 也就是移动的字节数**
- **origin为其实位置, 也就是从何处开始计算偏移量**
- 1. 0: 文件开头
- 2. 1: 当前位置
- 3. 2: 文件末尾
### 5. 文件缓冲区
- 在进行读写文件的时候, 操作系统并不会立即将文件读写到文件中, 而是先写入缓冲区, 然后缓冲区满再写入文件, fclose()调用的时候也将缓冲区的文件写入文件
- **fflush()用于将缓冲区的文件立即写入文件**
```c
int fflush(FILE *fp);
```
- **fp为文件指针**
- 如果函数返回NULL即为成功, 否则表示失败